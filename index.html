<!DOCTYPE html>
<html>
<head>
  <title>Turtle.js</title>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.8/ace.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.8/theme-solarized_light.js"></script>
  <style type="text/css">
    #editor {
      width: 300px;
      height: 300px;
      display: inline-block;
    }
    canvas {
      border: solid 1px #eee;
    }
  </style>
</head>
<body>
  <div id="editor"></div>
  <button onclick="run();">Run</button>
  <canvas width="300" height="300"></canvas>
  <div id="output"></div>

  <script type="text/javascript">
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/solarized_light");
    editor.getSession().setMode("ace/mode/javascript");
    editor.getSession().setOption("useWorker", false);
    editor.setValue(window.localStorage.getItem('code') || 'put your code here');
    editor.clearSelection();
    editor.focus();

    var textarea = document.getElementsByTagName('textarea')[0];
    var output = document.getElementById('output');
    var canvas = document.getElementsByTagName('canvas')[0];
    var context = canvas.getContext('2d');

    context.strokeStyle = 'black';


    var x, y, a;

    function log(text) {
      output.innerText += text + '\n';
    }

    function forward(distance) {
      log('Moving forward by ' + distance);
      x = x + distance * Math.cos(a / 180 * Math.PI);
      y = y - distance * Math.sin(a / 180 * Math.PI);
      context.lineTo(x, y);

    }

    function left(angle) {
      a += angle;
      log('Turning left by ' + angle + '\u00B0');
    }

    function right(angle) {
      a -= angle;
      log('Turning right by ' + angle + '\u00B0');
    }

    function run() {
      x = 150;
      y = 150;
      a = 90;
      canvas.width = canvas.width; // clowns
      context.moveTo(x, y);
      var code = editor.getValue();
      window.localStorage.setItem('code', code);
      output.innerText = '';
      try {
        var fun = new Function('forward', 'left', 'right', code);
        fun(forward, left, right);
      } catch(e) {
        console.error(e);
        log(e.message);
      }
      editor.focus();
      context.stroke();
    }
  </script>
</body>
</html>
